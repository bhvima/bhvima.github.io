---
layout: post
title: Exploiting Symmetries
usemathjax: true
---

Solving a seemingly exponentially hard problem in polynomial time 

<h1 class = "display-6">Problem</h1>

The Ising Model is used to represent the interaction of atomic "spins" of electrons in a metal. The spin is like an angular momentum which exerts force to charged particles. In the Ising Model, the particles can be in only one of two states (up or down). We will consider a simple case where there is only a line of particles in one dimension.
Our goal is to obtain the average energy of the system.

<h1 class = "display-6">Spin Configuration</h1>

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="361px" height="150px" viewBox="-0.5 -0.5 361 95" style="background-color: rgb(255, 255, 255); display: block; margin: auto;"><defs/><g><ellipse cx="180" cy="30" rx="180" ry="30" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-dasharray="3 3" pointer-events="all"/><path d="M 39 73 L 39 29.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 39 24.12 L 42.5 31.12 L 39 29.37 L 35.5 31.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 110 83 L 110 39.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 110 34.12 L 113.5 41.12 L 110 39.37 L 106.5 41.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 180.5 46 L 180.5 36 L 180.5 79.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 180.5 84.88 L 177 77.88 L 180.5 79.63 L 184 77.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 250 43 L 250 33 L 250 76.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 81.88 L 246.5 74.88 L 250 76.63 L 253.5 74.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 320 74 L 320 30.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 320 25.12 L 323.5 32.12 L 320 30.37 L 316.5 32.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/></g></svg>

In the discrete one dimensional Ising Model, to define a particular spin configuration we need to first specify how many particles are in our system. The spin configuration \\(\uparrow\uparrow\downarrow\downarrow\uparrow\\) above consists of 5 particles. Another thing to note is that the models will use periodic boundary conditions which idicates the last particle is connected to the first one.

<h1 class = "display-6">Energy</h1>

Given a configuration of spins we can define the energy using what is referred to as an Ising Hamiltonian:

$$H = -J\sum_{\left<ij\right>} \sigma_i\sigma_j + \mu\sum_i\sigma_i$$


where, \\(\sigma_i=1\\) if the \\(i^{th}\\) spin is up and \\(\sigma_i=-1\\) if it is down, and the brackets \\(\<ij\>\\) indicate a sum over spins that are connected, J is a constant that determines the energy scale, and \\(\mu\\) is a constant that determines the chemical potential.

For example, the Ising Hamiltonian for the spin configuration \\(\uparrow\uparrow\downarrow\downarrow\uparrow\\) is:

$$H = -J(1 + -1 + 1 + -1 + 1) + \mu(1 + 1 + -1 + -1 + 1) $$

<h1 class = "display-6">Probability</h1>

$$P(\alpha) = e^{-E(\alpha)/T}$$

defines the probability of observing a particular configuration of spins, \\(\alpha\\). Where \\(E(\alpha)\\) is the energy of a particular spin configuration, and \\( T \\) is the temperature in Kelvin. The probability of observing the configuration decays exponentially with increasing energy of \\(\alpha\\).

<h1 class = "display-6">Expectation Value</h1>

In a dynamical, fluctuating system the spin configuration changes. The average energy of the system can be obtained by adding up the value of an individual configuration multiplied by it's respective probability. 

$$\left<E\right> = \frac{\sum_\alpha E(\alpha)P(\alpha)}{\sum_\alpha P(\alpha)} = \frac{\sum_\alpha E(\alpha)e^{-E(\alpha)/T}}{\sum_\alpha e^{-E(\alpha)/T}} $$

Meaning to obtain the average value (expectation value) computationally, one must compute both the energy and it's probability over all possible configurations. For a given number of spins (particles) the number of possible configurations increases exponentially.

<h1 class = "display-6">Solution</h1>

Let us consider calculating the expectation value for \\( n \\) particles. The summation would require visiting all the \\(2^n\\) spin configurations which makes it an exponentially hard problem as \\( n \\) increases. 

However, there is an interesting catch. There are multiple groups of spin configurations that share the same energy. 

***

Consider two spin configuration with the same number of particles. Recall the energy is defined by,

$$E(\alpha) = -J\sum_{\left<ij\right>} \sigma_i\sigma_j + \mu\sum_i\sigma_i$$

where \\( J \\) and \\( \mu \\) are constants. Therefore, \\( E(\alpha_1) = E(\alpha_2) \\) 

* If they have the same number of \\( \uparrow \\) and \\( \downarrow \\)

* If they the have the same number of series where a series is a sequence of \\( \uparrow \\) between two \\( \downarrow \\) with periodic boundary conditions

For example, 

\\(\uparrow\uparrow\uparrow\uparrow\uparrow\downarrow\uparrow\downarrow\downarrow\downarrow\\), \\(\uparrow\uparrow\downarrow\uparrow\uparrow\uparrow\uparrow\downarrow\downarrow\downarrow\\), \\(\uparrow\uparrow\downarrow\downarrow\downarrow\uparrow\downarrow\uparrow\uparrow\uparrow\\), \\(\uparrow\downarrow\downarrow\uparrow\downarrow\downarrow\uparrow\uparrow\uparrow\uparrow\\), \\(\uparrow\downarrow\downarrow\downarrow\uparrow\uparrow\uparrow\uparrow\uparrow\downarrow\\), \\(\uparrow\downarrow\downarrow\downarrow\uparrow\uparrow\uparrow\uparrow\downarrow\uparrow\\)

all have the 6 \\( \uparrow \\) and 4 \\( \downarrow \\) and 2 series. Therefore, they have the same energy.

***

Let the number of spins (particles) be \\( n \\), the number of \\( \downarrow \\) be \\( r \\), and the number of series be \\( k \\). 

We need to find a function \\( N(n, r, k) \\) that outputs the number of spin configurations that satisfy those properties. 

For \\( r = 0 \text{ or } n \\), there are no series possible i.e. \\( k = 0 \\) and \\( N(n, r, k) = 1\\)

For \\( 0 < r < n \\), the series are bounded by \\( 1 \leq k \leq min(r, n - r) \\) 

*** 

In the figure below, there are multiple spin configurations:

<img src="{{ site.baseurl }}/images/spin_config_area_example.png" class="img-fluid" alt="spin_config_area_example" width="200"/>

it is evident that for a spin configuration with \\( k \\) series there will be \\( k + 1 \\) blue areas and \\( k \\) red areas. Let an area be a location where a particle may or may not be placed. 

***

Since there are \\( k \\) series there are at least \\( k \downarrow \\) and \\( k \uparrow \\) in the configuration which leaves 
\\( r - k \\) \\( \downarrow \\) and \\( n - r - k \\) \\( \uparrow \\) to be distributed.

Case 1. the first particle in the spin configuration is \\( \downarrow \\)

* \\( r - k \downarrow \\) distributed among \\( k + 1\\) areas 

  $$ \binom{(r - k) + (k + 1) - 1}{(k + 1) - 1} = \binom{r}{k} $$

* \\( n - r - k \uparrow \\) distributed among \\( k \\) areas

  $$ \binom{(n - r - k) + (k) - 1}{(k) - 1} = \binom{n - r - 1}{k - 1} $$

Case 2. the first particle in the spin configuration is \\( \uparrow \\)

* \\( n - r - k \uparrow \\) distributed among \\( k + 1\\) areas 

  $$ \binom{(n - r - k) + (k + 1) - 1}{(k + 1) - 1} = \binom{n - r}{k} $$

* \\( r - k \downarrow \\) distributed among \\( k \\) areas

  $$ \binom{(r - k) + (k) - 1}{(k) - 1} = \binom{r - 1}{k - 1} $$

Therefore, 

$$\begin{aligned} N(n, r, k) &= \binom{r}{k}\binom{n-r-1}{k-1}+\binom{n-r}{k}\binom{r-1}{k-1} \\ &= \frac{r}{k}\binom{r-1}{k-1}\binom{n-r-1}{k-1}+\frac{n-r}{k}\binom{n-r-1}{k-1}\binom{r-1}{k-1} \\ &=  \frac{n}{k}\binom{r-1}{k-1}\binom{n-r-1}{k-1}\end{aligned}$$

***

$$
 N(n, r, k) =
\begin{cases}
1,  & r = 0, k = 0 \\
\frac{n}{k}\binom{r-1}{k-1}\binom{n-r-1}{k-1}, & 1 \leq r < n, 1 \leq k \leq min(r, n - r) \\
1,  & r = n, k = 0
\end{cases}
$$

***

Now, that we know the size of each of the groups we need to calculate the energy of said group. That is we need to define a function \\( E(n, r, k) \\) which outputs the energy of spin configurations that satisfy those properties. 

That is rather simple, 

$$ E(n,r,k) = -J(n - 4k) + \mu(n - 2r)$$

***

<h1 class = "display-6">Algorithm</h1>

That provides us a nice polynomial time solution to the problem. :)

~~~python
from math import comb
from numpy import exp

J = 1
mu = 1.1
T = 1

def N(n, r, k):
    return (comb(n - r - 1, k - 1) * comb(r - 1, k - 1) * n)//k

def E(n, r, k):
    return -J * (n - 4 * k) + mu * (n - 2 * r)

def compute_average_energy(n):
    num = denum = 0
    for r in range(n + 1):
        if r == 0 or r == n:
            energy = E(n, r, 0)
            prob = exp(-energy/T)
            num += energy * prob
            denum += prob
        for k in range(1, min(r, n - r) + 1):
            energy = E(n, r, k)
            freq = N(n, r, k)
            prob = exp(-energy/T)
            num += freq * energy * prob
            denum += freq * prob
    return num/denum
~~~